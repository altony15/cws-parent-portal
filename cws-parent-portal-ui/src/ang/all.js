!function(){"use strict";var e=angular.module("cws",["ui.router","ngResource","toastr"]);e.controller("cwsMainCtrl",["$scope","ERRORS","toastr","AuthService",function(e,t,r,o){e.$on(t.badRequest,function(){r.error("Invalid request","Error")}),e.$on(t.notFound,function(){r.error("Resource not found","Error")}),e.$on(t.notAuthenticated,function(){r.error("Unauthorized request","Error"),o.logout()}),e.$on(t.server,function(){r.error("Unexpected error","Error")})}]).run(["$rootScope","$state","AuthService","ERRORS",function(e,t,r,o){e.$on("$stateChangeStart",function(e,o){o.authenticate&&!r.isAuthenticated()?(e.preventDefault(),t.go("authentication.login",{},{reload:!0})):!o.authenticate&&r.isAuthenticated()&&(e.preventDefault(),t.go("messages.inbox",{},{reload:!0}))})}]).factory("AuthInterceptor",["$rootScope","$q","ERRORS",function(e,t,r){return{request:function(e){return e},requestError:function(e){return e},response:function(t){switch(t.status){case 400:e.$broadcast(r.badRequest);break;case 404:e.$broadcast(r.notFound);break;case 401:case 403:e.$broadcast(r.notAuthenticated);break;case 500:e.$broadcast(r.server)}return t},responseError:function(e){return console.log("Response error is: ",e),e}}}]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}])}(),function(){"use strict";var e=angular.module("cws");e.config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/messages","/messages/inbox"),e.state("main",{templateUrl:"app/shared/main/main.html","abstract":!0,controller:"mainController",controllerAs:"mainvm"}).state("authentication",{templateUrl:"app/components/authentication/authentication.html","abstract":!0,controller:"authenticationController"}).state("authentication.login",{templateUrl:"app/components/authentication/login/login.html",url:"/login",parent:"authentication",controller:"loginController",authenticate:!1}).state("authentication.forgotpass",{templateUrl:"app/components/authentication/forgotpass/forgotpass.html",url:"/forgot-password",parent:"authentication",controller:"forgotPassController",authenticate:!1}).state("createprofile",{templateUrl:"app/components/createprofile/createProfile.html",url:"/create-profile",controller:"createProfileController",authenticate:!1}).state("messages",{parent:"main",url:"/messages",templateUrl:"app/components/messages/messagesView.html",controller:"messagesController",authenticate:!0}).state("editprofile",{url:"/profile",templateUrl:"app/components/editprofile/editProfile.html",controller:"editProfileController",authenticate:!0}).state("messages.inbox",{parent:"messages",url:"/inbox",templateUrl:"app/components/messages/inbox/inbox.html",controller:"inboxController",authenticate:!0}).state("messages.sent",{parent:"messages",url:"/sent",templateUrl:"app/components/messages/sent/sent.html",controller:"sentController",authenticate:!0}).state("messages.newmessage",{parent:"messages",url:"/new-message",templateUrl:"app/components/messages/newMessage/newMessage.html",controller:"newMessageController",authenticate:!0}).state("messages.single",{parent:"messages",url:"/:id",templateUrl:"app/components/messages/single/singleMessage.html",controller:"singleMessageController",authenticate:!0}).state("fosterAgencies",{parent:"main",url:"/foster-agencies",templateUrl:"app/components/fosterAgencies/fosterAgencies.html",controller:"fosterAgenciesController",authenticate:!0}).state("fosterAgency.single",{parent:"fosterAgency",url:"/foster-agency/:id",templateUrl:"app/components/fosterAgency/singleAgency.html",controller:"singleAgencyController",authenticate:!0}),t.otherwise(function(e){var t=e.get("$state");t.go("messages.inbox")})}])}(),function(){"use strict";angular.module("cws").service("AuthService",["$rootScope","$q","$http",function(e,t,r){function o(){var e=window.localStorage.getItem(l);c=window.localStorage.getItem(u),e&&s(e)}function n(e){window.localStorage.setItem(l,e.token),window.localStorage.setItem(u,e.userId),c=e.userId,s(e.token)}function s(e){d=!0,i=e,r.defaults.headers.common["X-Auth-Token"]=e}function a(){i=void 0,d=!1,r.defaults.headers.common["X-Auth-Token"]=void 0,window.localStorage.removeItem(l),window.localStorage.removeItem(u)}var i,c,l="CWS-Key",u="CWS-User",d=!1,g=function(){a()};return o(),{storeUserCredentials:n,logout:g,isAuthenticated:function(){return d},getUserId:function(){return c}}}])}(),function(){"use strict";angular.module("cws").factory("Conversation",["API_LINKS","$resource",function(e,t){var r={};return r.resource=t(e.baseurl+"conversation/:id",{id:"@id",box:"@box"},{update:{method:"PUT"}},{stripTrailingSlashes:!1}),r}])}(),function(){"use strict";angular.module("cws").factory("FosterAgency",["$resource","API_LINKS",function(e,t){return e(t.baseurl+"agencies/:id")}])}(),function(){"use strict";angular.module("cws").factory("Message",["API_LINKS","$resource",function(e,t){var r={};return r.resource=t(e.baseurl+"message/:id",{id:"@id"},{update:{method:"PUT"}},{stripTrailingSlashes:!1}),r}])}(),function(){"use strict";angular.module("cws").factory("User",["AuthService","$q","$http","API_LINKS","$resource",function(e,t,r,o,n){var s={};return s.resource=n(o.baseurl+"users/:id",{id:"@id"},{update:{method:"PUT"}},{stripTrailingSlashes:!1}),s.login=function(n,a){return t(function(t,i){r.post(o.baseurl+"session",{email:n,password:a}).then(function(r,o){1==r.data.success?(e.storeUserCredentials(r.data),t("Login success."),s.data=s.resource.get({id:"me"})):i("Login Failed.")},function(){i("Login Failed.")})})},e.isAuthenticated()&&(s.data=s.resource.get({id:"me"})),s}])}(),function(){"use strict";angular.module("cws").constant("API_LINKS",window.__env).constant("ERRORS",{notAuthenticated:"auth-not-authenticated",notFound:"resource-not-found",badRequest:"bad-request",server:"server-internal-error"})}(),function(){"use strict";function e(){return{request:function(e){return $(".loading").addClass("active"),e},requestError:function(e){return $(".loading").removeClass("active"),e},response:function(e){return $(".loading").removeClass("active"),e},responseError:function(e){return $(".loading").removeClass("active"),e}}}angular.module("cws").factory("spinner",e).config(["$httpProvider",function(e){e.interceptors.push("spinner")}])}(),function(){"use strict";angular.module("cws").controller("authenticationController",function(){$(".flexslider").flexslider({animation:"slide"})})}(),function(){"use strict";angular.module("cws").controller("createProfileController",["$scope","User","AuthService","toastr",function(e,t,r,o){function n(e,t){return e===t}function s(e){return a.test(e)}$(".selectpicker").selectpicker(),e.user=new t.resource,e.formSubmitted=!1,e.formValid=!1;var a=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})");new RegExp("^(((?=.*[a-z])(?=.*[A-Z]))|((?=.*[a-z])(?=.*[0-9]))|((?=.*[A-Z])(?=.*[0-9])))(?=.{6,})");e.register=function(){return console.debug(e.user),e.formSubmitted=!0,s(e.user.password)?n(e.user.password,$("#cpassword").val())?(e.passStrong=!0,e.passMatch=!0,e.formValid=!0,$(".loading").addClass("active"),t.resource.save(e.user,function(e){$(".loading").removeClass("active"),e.success?(r.storeUserCredentials(e),window.location="/"):o.error(e.message,"Error")},function(e){o.error(e,"Error"),console.log(e)}),void 0):(e.passNotMatch=!0,e.formValid=!1,!1):(e.passWeak=!0,e.formValid=!1,!1)}}])}(),function(){"use strict";angular.module("cws").controller("editProfileController",["$scope","$http","User",function(e,t,r){r.data.$promise.then(function(t){t.success?(e.user=t.user,e.user.address.zip=Number(t.user.address.zip)):console.log("Failed to load the user resources")}),e.update=function(){r.resource.update({id:"me"},e.user)}}])}(),function(){"use strict";angular.module("cws").controller("fosterAgenciesController",["$scope","FosterAgency","User",function(e,t,r){r.data.$promise.then(function(r){e.fosterAgencies=t.query({zipcode:r.user.address.zip})}),e.print=function(){window.print()}}])}(),function(){"use strict";angular.module("cws").controller("messagesController",["$scope","User",function(e,t){t.data.$promise.then(function(t){e.user=t}),$(".sidebar").click(function(){$(".sidebar").removeClass("active")})}])}(),function(){"use strict";angular.module("cws").controller("mainController",["$scope","AuthService","User",function(e,t,r){r.data.$promise.then(function(t){t.success?e.user=t.user:console.log("Failed to load the user resources"),$(".loading").removeClass("active")})}])}(),function(){"use strict";angular.module("cws").directive("cwsNav",["AuthService",function(e){return{restrict:"AE",scope:{user:"="},replace:!0,templateUrl:"app/shared/nav/navView.html",link:function(t,r,o){t.logout=function(){e.logout(),window.location="/"},t.showMsgSidebar=function(){$(".sidebar").toggleClass("active")}}}}])}(),function(){"use strict";angular.module("cws").controller("forgotPassController",["$scope","$rootScope",function(e,t){t.message="Hello World",console.log("LoggedForm")}])}(),function(){"use strict";angular.module("cws").controller("loginController",["$scope","$state","User",function(e,t,r){e.data={},e.login=function(e){r.login(e.username,e.password).then(function(e){t.go("messages.inbox",{},{reload:!0})},function(e){alert("Oops! That email / password combination is not valid.")})}}])}(),function(){"use strict";angular.module("cws").controller("singleAgencyController",["$scope",function(e){}])}(),function(){"use strict";angular.module("cws").controller("inboxController",["$scope","Conversation",function(e,t){e.conversations=t.resource.query({select:"receiver"}),e.getSender=function(e){return e.sender.name.first_name+" "+e.sender.name.last_name},e.getReceiver=function(e){return e.receiver.name.first_name+" "+e.receiver.name.last_name}}])}(),function(){"use strict";angular.module("cws").controller("newMessageController",["$scope","User","Conversation","$state","toastr",function(e,t,r,o,n){e.conversation=new r.resource,$(".selectpicker").selectpicker(),e.newConversation=function(){return console.debug(e.conversation),$(".loading").addClass("active"),console.log(e.conversation.receiver),void 0==e.conversation.receiver?(n.error("Please select a receiver","Error"),$(".loading").removeClass("active"),!1):(r.resource.save(e.conversation,function(t){t.success&&(e.conversation=new r.resource,o.go("messages.inbox",{},{reload:!0}),$(".loading").removeClass("active"))}),void console.debug(conversation))}}])}(),function(){"use strict";angular.module("cws").controller("sentController",["$scope","Conversation",function(e,t){e.conversations=t.resource.query({select:"sender"})}])}(),function(){"use strict";angular.module("cws").controller("singleMessageController",["$scope","$stateParams","Conversation","Message","User",function(e,t,r,o,n){function s(){a.animate({scrollTop:a.height()},"slow")}var a=$(".messages-wrapper");e.conversation=r.resource.get({id:t.id},function(){n.data.id!=e.conversation.sender.id&&(e.replymessage.receiver=e.conversation.sender.id)}),s(),$('[data-toggle="popover"]').popover(),e.replymessage=new o.resource,e.replymessage.conversation_id=t.id,e.reply=function(){o.resource.save(e.replymessage,function(t){t.success&&(t.message.sender=n.data,e.conversation.messages.push(t.message),s(),e.replymessage.content="")})},e.print=function(){window.print()}}])}();